<!DOCTYPE html>
<html xmlns:th="http://thymeleaf.org">
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">

    <title>Zamówienia</title>


</head>
<body>
    <a href="index.html" th:href="@{http://localhost:8080/}"><button type="button" class="btn btn-primary btn-lg">Strona główna</button></a>
    <a href="orderForm.html" th:href="@{http://localhost:8080/order/orderForm}"><button type="button" class="btn btn-primary btn-lg">Nowe zamówienie</button></a>
    <h1>Zamówienia</h1>



<!--    <button type="submit" name="addOrder">Nowe zamówienie</button>-->
    <!-- Trigger the modal with a button -->
<!--    <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#newOrder">Nowe zamówienie</button>-->

    <!-- Modal -->
<!--    <div id="newOrder" class="modal fade" role="dialog">-->
<!--        <div class="modal-dialog">-->

<!--            &lt;!&ndash; Modal content&ndash;&gt;-->
<!--            <div class="modal-content">-->
<!--                <div class="newOrder">-->
<!--                    <button type="button" class="close" data-dismiss="modal">&times;</button>-->
<!--                    <h4 class="modal-title">Nowe zamówienie</h4>-->
<!--                </div>-->

<!--                <div class="modal-body">-->
<!--                    <form th:action="@{/order/addNewOrder}" th:object="${newOrder}" method="post">-->
<!--                        <p>...</p>-->
<!--                        <div class="form-group">-->
<!--                            <label for="description">Description:</label>-->
<!--                            <input type="text" class="form-control" id="description" th:value="*{description}"/>-->
<!--                        </div>-->
<!--                        <input type="submit" value="Zapisz"/>-->
<!--                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Zamknij</button>-->
<!--                    </form>-->
<!--                </div>-->

<!--&lt;!&ndash;                <div class="modal-footer">&ndash;&gt;-->
<!--&lt;!&ndash;                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Zamknij</button>&ndash;&gt;-->
<!--&lt;!&ndash;                    <button type="button" class="btn btn-primary" th:action="@{/addOrder}" th:object="${order}" th:href="@{/order/orders}" method="post">Utwórz</button>&ndash;&gt;-->
<!--&lt;!&ndash;                    <button type="submit" class="btn btn-primary" th:href="@{/}">Utwórz</button>&ndash;&gt;-->
<!--&lt;!&ndash;                </div>&ndash;&gt;-->
<!--            </div>-->

<!--        </div>-->
<!--    </div>-->

    <table class="table table-striped table-bordered table-hover">
        <tr>
            <th>Id</th>
            <th>Adres</th>
            <th>Uwagi</th>
            <th>Rodzaj jedzenia</th>
            <th>Czas przyjęcia do realizacji</th>
            <th>Czas do dostarczenia</th>
            <th>Czas zamknięcia</th>
            <th>Status</th>
            <th>Kierowca</th>
            <th>Akcje</th>
        </tr>
        <tr th:each="o, stat : ${orders}">
            <td th:text="${o.id}"></td>
            <td>
                <div>
                    <p th:text="${o.address}!=null ? (${o.address.street} + ' ' + ${o.address.buildingNumber}) : ' '"></p>
                    <p></p>
                </div>
            </td>
            <td th:text="${o.description}"></td>
            <td th:text="${o.foodType}"></td>

<!--            <td th:text="${o.createTime}"></td>-->
            <td th:text="${o.createTime}"></td>

            <td>
                <p th:id="'timer-'+${stat.count}"></p>
                <script>
                    // Set the date we're counting down to
                    // var deliveryTime = new Date([[${o.timeToDelivery}]]).getTime();
                    //console.log("delivery date: " + /*[[${o.timeToDelivery}]]*/);
                    //console.log([[${o.timeToDelivery}]]);
                    //var deliveryTime = new Date().getTime() + 10000;



                    var deliveryTime = [[${o.secondsToDelivery}]];
                    //deliveryTime *= 1000000000;

                    // Update the count down every 1 second
                    var x = setInterval(function() {
                        var index = [[${stat.count}]];
                        //console.log(index);
                        // Get today's date and time
                        var now = new Date().getTime()/1000000000;
                        // console.log('time to delivery' + [[${o.secondsToDelivery}]]);
                        // console.log('now time' + now);
                        // Find the distance between now and the count down date
                        var distance = deliveryTime - now;

                        // Time calculations for days, hours, minutes and seconds
                        var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                        var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                        var seconds = Math.floor((distance % (1000 * 60)) / 1000);

                        // Display the result in the element with id="demo"
                        //console.log("timer id: "+'timer-'+index);
                        document.getElementById('timer-'+index).innerHTML =hours + ":"
                            + minutes + ":" + seconds;

                        // If the count down is finished, write some text
                        if (distance < 0) {

                        }
                    }, 1000);
                </script>

            </td>


            <td th:text="${o.closeTime}"></td>

            <td th:text="${o.status}"></td>
            <td th:text="${o.driver}!=null ? (${o.driver.firstName} + ' ' + ${o.driver.lastName}) : 'brak przypisanego kierowcy'"></td>
            <td>
                <div>
                    <a th:href="@{http://localhost:8080/order/removeOrder/{id}(id=${o.id})}">
                        <button type="button" class="btn btn-danger">Usuń</button></a>
                    <a th:href="@{http://localhost:8080/order/addOrder/{orderId}/toDriver(orderId=${o.id})}">
                        <button type="button" class="btn btn-primary">Przypisz kierowcę</button></a>
                </div>
            </td>
        </tr>
    </table>



</body>
</html>